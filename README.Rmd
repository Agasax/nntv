---
title: "NNTV"
author: 
  - "Lars MÃ¸lgaard Saxhaug https://twitter.com/load_dependent\n"
date: 
  - Last compiled on `r format(Sys.time(), '%A %d %B, %Y')`
output: github_document
---

```{r setup, include=FALSE}
pacman::p_load(tidyverse,
               ggthemes,
               gganimate)
theme_set(theme_fivethirtyeight())
```


```{r sim, echo=TRUE}
base_risk <- 0.001
sample_size=1e6
vaccinated_risk <- 0.0002
ve_true <- (base_risk-vaccinated_risk)/base_risk
weeks <- 52
df <- tibble(week=0:weeks,
            sample_siz=sample_size,
            vaccinated_at_risk=sample_size*(1-vaccinated_risk)^week,
            placebo_at_risk=sample_size*(1-base_risk)^week,
            vaccinated_cases=sample_size-vaccinated_at_risk,
            placebo_cases=sample_size-placebo_at_risk)

df <- df  %>% 
  mutate(eer=(vaccinated_cases)/placebo_at_risk,
         cer=(placebo_cases)/placebo_at_risk,
         rr=eer/cer,
         ve=1-rr,
         ar=cer-eer,
         nntv=1/ar
         ) %>% 
  drop_na()

```
True vaccine efficacy is `r scales::percent(ve_true)`
```{r ve,echo=FALSE}
 ve_plot <-  df %>% 
  ggplot(aes(x=week,y=ve))+
  geom_line(colour="steelblue")+
  geom_point(size=2,colour="steelblue")+
  theme_solarized()+
  theme(legend.position = "none")+
  scale_y_continuous(name="VE",labels = scales::percent_format(),limits = c(0,1))+
  scale_x_continuous(name="Weeks")+
  labs(title="Vaccine efficacy, by weeks of follow up")+
  transition_reveal(week) 
  animate(ve_plot,end_pause=10)
```

```{r nntv, echo=FALSE}
  nntv_plot <- df %>% 
  ggplot(aes(x=week,y=nntv))+
  geom_line(colour="steelblue")+
  geom_point(size=2,colour="steelblue")+
  theme_solarized()+
  theme(legend.position = "none")+
  scale_y_continuous(name="NNTV")+
  scale_x_continuous(name="Weeks")+
  labs(title="Number needed to vaccinate, by weeks of follow up")+
  transition_reveal(week) 
  animate(nntv_plot,end_pause=10)
```

 
 
