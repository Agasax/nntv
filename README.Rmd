---
title: "NNTV"
author: 
  - "Lars MÃ¸lgaard Saxhaug https://twitter.com/load_dependent\n"
date: 
  - Last compiled on `r format(Sys.time(), '%A %d %B, %Y')`
output: github_document
---

```{r setup}
# packages
pacman::p_load(tidyverse,
               ggthemes,
               gganimate)

```


```{r sim, echo=TRUE}
base_risk <- 0.001 # risk per  week placebo group
ve_true <- 0.8 # vaccine efficacy, 1-rr
vaccinated_risk <- base_risk -ve_true*base_risk  # risk per  week vaccinated group
sample_size=1e6 # size of each group
weeks <- 52 # number of weeks

df <- tibble(
  week = rep(1:weeks,3),
  
  vaccinated_cases = sample_size * vaccinated_risk * week,
  placebo_cases = sample_size * base_risk * week
) %>%
  mutate(
    eer = (vaccinated_cases) / sample_size, # exposed event risk
    cer = (placebo_cases) / sample_size, # placebo event risk
    rr = eer / cer,
    ve = 1 - rr,
    ar = cer - eer,
    nntv = 1 / ar
  )
```
True vaccine efficacy is `r scales::percent(ve_true)`
```{r ve,echo=FALSE, cache=TRUE}
 ve_plot <-  df %>% 
  ggplot(aes(x=week,y=ve))+
  geom_line(colour="steelblue")+
  geom_point(size=2,colour="steelblue")+
  theme_solarized()+
  theme(legend.position = "none")+
  scale_y_continuous(name="VE",labels = scales::percent_format(),limits = c(0,1))+
  scale_x_continuous(name="Weeks")+
  labs(title="Vaccine efficacy, by weeks of follow up",caption = "@load_dependent")+
  transition_reveal(week) 
  animate(ve_plot,end_pause=10)
```

```{r nntv, echo=FALSE,cache=TRUE}
  nntv_plot <- df %>% 
  ggplot(aes(x=week,y=nntv))+
  geom_line(colour="steelblue")+
  geom_point(size=2,colour="steelblue")+
  geom_hline(yintercept = 1,linetype="dashed",alpha=0.5)+
  theme_solarized()+
  theme(legend.position = "none")+
  scale_y_continuous(name="NNTV",breaks = c(1,400,800,1200))+
  scale_x_continuous(name="Weeks")+
  labs(title="Number needed to vaccinate, by weeks of follow up",subtitle=paste("Vaccine efficacy",scales::percent(ve_true),", base risk",scales::percent(base_risk,accuracy = 0.1),"per week"), caption = "@load_dependent")+
  transition_reveal(week) 
  animate(nntv_plot,end_pause=10)
```

 
 
